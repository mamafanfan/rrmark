---
title: "Using R markdown for Scientific Papers"
author: "A Chan, 4mg@outlook.com"
date: "12/3/2015"
output:
  html_document:
    fig_caption: yes
    fig_height: 4
    fig_width: 6
    force_captions: yes
    highlight: pygments
    keep_md: yes
    self_contained: no
    theme: cerulean
  pdf_document:
    fig_caption: yes
    keep_tex: yes
    number_sections: yes
  word_document: default
csl: assets/bibtex/mee.csl
bibliography: assets/bibtex/references.bib
---

```{r begin, echo=TRUE, message=FALSE, warning=FALSE}
  # devtools::install_github("cboettig/knitcitations@v1")
  library(knitcitations); cleanbib()
  cite_options(citation_format = "pandoc", check.entries=FALSE)
  library(bibtex)
  write.bibtex(c(citation("bibtex"), citation("knitr")[1], citation("knitcitations"), citation("xtable"), citation("RefManageR"), citation("rmarkdown")), file="init.bib")
  bib <- read.bibtex("init.bib")
  bib.1 <- read.bibtex("citavi.bib")
```

### Abstract

This document was created based on a .Rmd template from a blog [post](http://www.petrkeil.com/?p=2401> "Simple Rmd Template") by `r citet("http://www.petrkeil.com/?p=2401")`. The R package "knitr" `r citep(citation("knitr"))` has its strengths in reproducible research, but it is not designed to produce citations in various foramts for scientific papers. The .Rmd template makes use of an xml file for formatting citation styles, "knitcitations" `r citep(citation("knitcitations"))` and "bibtex" `r citep(citation("bibtex"))` for generating citations by DOIs or bibtex.

### Introduction

The template give examples of writing mathematical equations using LaTeX, formatting R outputs using either knitr::kable `r citep(citation("knitr"))` or "xtable" `r citep(citation("xtable"))`, producing graphic plots using the base "plot" function and generating citations using automatic DOI lookup or "bibtex" `r citep(citation("bibtex"))` with knitcitations::citep and knitcitations::citet `r citep(citation("knitcitations"))`.

### Methods

[Rmarkdown](http://rmarkdown.rstudio.com/authoring_pandoc_markdown.html "Rmarkdown Syntax") `r citep(citation("rmarkdown"))` has full documentation for its syntax. Statistical analysis with plots and tables can be easily created in a .Rmd file by embedding and running "R code chunks" while math equations are produced using \TeX or \LaTeX. Rmarkdown (v2) has built-in support for citation as it is based on [Pandoc](http://johnmacfarlane.net/pandoc/ "Pandoc Document Converter"), but it does not have automatic DOI lookup and is better suited to work in conjunction with a citation manager from which bibliography files are generated and exported for its use.

#### Equations

Inline equations are enclosed by `$` with no space following or preceding. A separate paragraph for equations is enclosed by `$$` following/preceding with a single space. [Sharelatex](https://www.sharelatex.com/learn/Mathematical_expressions "Math Expression (ShareLaTex)") has detailed documentation for creating mathematical expressions.

The binomial coefficient is defined as

```
$$ \binom{n}{k} = \frac{n!}{k!(n-k)!} $$
or
\[ ... \]
```

\[ \binom{n}{k} = \frac{n!}{k!(n-k)!} \]

These are all Greek $\alpha, \beta, \theta_0, \epsilon_2, \eta, \lambda^2, \mu, \tau, \sigma$

In least squares prediction models, we estimate $\beta_0, \beta_1, \beta_2, ...\beta_n$ by minimizing the RSS

```
\[ RSS=\sum_{i=1}^{n} \Big( y_i - \beta_0 - \sum_{j=1}^{p}\beta_{j}x_{ij}\Big)^2 \]
```

\[ RSS=\sum_{i=1}^{n} \Big( y_i - \beta_0 - \sum_{j=1}^{p}\beta_{j}x_{ij}\Big)^2 \]

#### Tables

```{r kable, echo=TRUE}
library(knitr)
library(ISLR)
attach(Wage)
fit <- lm(wage ~ poly(age, 4), data=Wage)
kable(summary(fit)$coef, digits=2, caption="This is a 4th degree polynomial. Coef output knitr::kable")
```

#### Plots

```{r Wage, echo=TRUE, fig.cap="Degree-4 Polynomial. Relationship between Wage and Age (data(Wage) in \"ILSR\". The dotted lines are 95% confidence intervals.", fig.height=6, fig.width=6}
## fit<-lm(Wage$wage~poly(Wage$age,4),data=Wage)
agelims<-range(Wage$age)
age.grid<-seq(from=agelims[1], to=agelims[2])
preds <- predict(fit, newdata=list(age=age.grid), se=TRUE)
se.bands <- cbind(preds$fit+2*preds$se.fit, preds$fit-2*preds$se.fit)
## par(mfrow=c(1,2), mar=c(4.5,4.5,1,1),oma=c(0,0,4,0))
plot(age, wage, xlim=agelims, cex=.5, col="darkgrey")
title("Degree-4 Polynomial", outer=F)
lines(age.grid, preds$fit, lwd=2, col="blue")
matlines(age.grid, se.bands, lwd=1, col="blue", lty=3)
```


#### Citations

In "The Elements of Statistical Learning", `r citet(bib.1[["Hastie.2009"]])` explain with practical examples the application of ridge regression/lasso. The book covers some advanced materials in data mining, inference and prediction. For a less technical treatment of the same subjects, "An Introduction of Statistical Learning" `r citep("DOI 10.1007/978-1-4614-7138-7")` should be a good start. 

The two types of citation above are respectively generated by

```
citet(bib.1[["Hastie.2009"]]) and
citep("DOI 10.1007/978-1-4614-7138-7")
```

`citet` and `citep` can also refer to either DOI or a bibtex entry, `citet(bib.1[["Hastie.2009"]])` generates `r citet(bib.1[["Hastie.2009"]])` where "bib.1"" is a R object created by `bib.1<-read.bibtex("name of bibliography file")` and "Hastie.2009" is the bibtex entry ID.

### Summary

Plots, tables, math equations and citations are indispensible elements of any scientific papers. The Rmd template is a quick and convenient way to produce them. The finished Rmd file can then be "knited" to html, pdf or word format for submission in [RStudio](http://www.rstudio.com/ "RStudio"). To publish this in a jekyll blog, what I did was to knit it to html and include the html file in a post with a liquid tag. 

Finally, the reference list below is produced by using "bibtex" to write out all citations made in the paper `write.bibtex(file="references.bib")`. `reference.bib` and a style file are declared in the front matter.

### References

```{r writeBib, warning=FALSE, message=FALSE, echo=FALSE} 
  write.bibtex(file="references.bib")
```
